<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Stopwatch Game - Login</title>
<style>
  body, html { margin:0; padding:0; font-family:sans-serif; background:#111; color:#fff; display:flex; justify-content:center; align-items:center; height:100%; }
  #container { width:360px; padding:2rem; border-radius:15px; background:rgba(0,0,0,0.8); text-align:center; }
  input, button { width:90%; margin:0.3rem 0; padding:0.5rem; border-radius:8px; border:none; }
  button:hover { cursor:pointer; filter: brightness(1.2); }
  .hidden { display:none; }
</style>
</head>
<body>
<div id="container">
  <div id="authSection">
    <h2>Login / Register</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <button id="registerBtn">Register</button>
    <p id="authMsg"></p>
  </div>

  <div id="stopwatchSection" class="hidden">
    <h1>Stopwatch Game</h1>
    <p>Logged in as: <span id="userEmail"></span></p>
    <button id="logoutBtn">Logout</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = 'https://bfzsqcufdsqrgtcqgazp.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJmenNxY3VmZHNxcmd0Y3pwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzNzA3NzYsImV4cCI6MjA3MDk0Njc3Nn0.QoTEgmXGtVR8x4vzLLfhjy_Ny0txVu2C3ru288oxPIo';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

let user = null;

const authSection = document.getElementById('authSection');
const stopwatchSection = document.getElementById('stopwatchSection');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');
const authMsg = document.getElementById('authMsg');
const logoutBtn = document.getElementById('logoutBtn');
const userEmail = document.getElementById('userEmail');

function showStopwatch() {
  authSection.classList.add('hidden');
  stopwatchSection.classList.remove('hidden');
  userEmail.textContent = user.email;
}

async function login() {
  authMsg.textContent = '';
  const { data, error } = await supabase.auth.signInWithPassword({
    email: emailInput.value,
    password: passwordInput.value
  });
  if (error) authMsg.textContent = 'Login failed: ' + error.message;
  else { user = data.user; showStopwatch(); }
}

async function register() {
  authMsg.textContent = '';
  const { data, error } = await supabase.auth.signUp({
    email: emailInput.value,
    password: passwordInput.value
  });
  if (error) authMsg.textContent = 'Register failed: ' + error.message;
  else { authMsg.textContent = 'Registration successful! You can now log in.'; }
}

async function logout() {
  await supabase.auth.signOut();
  user = null;
  authSection.classList.remove('hidden');
  stopwatchSection.classList.add('hidden');
}

loginBtn.addEventListener('click', login);
registerBtn.addEventListener('click', register);
logoutBtn.addEventListener('click', logout);

// Auto-login if already signed in
supabase.auth.getSession().then(({ data }) => {
  if (data.session) {
    user = data.session.user;
    showStopwatch();
  }
});
</script>
</body>
</html>
